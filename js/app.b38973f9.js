(function(e){function t(t){for(var a,s,r=t[0],c=t[1],d=t[2],u=0,m=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&m.push(o[s][0]),o[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);l&&l(t);while(m.length)m.shift()();return i.push.apply(i,d||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,r=1;r<n.length;r++){var c=n[r];0!==o[c]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},o={app:0},i=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/vivid-app/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var d=0;d<r.length;d++)t(r[d]);var l=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var a=n("85ec"),o=n.n(a);o.a},"22a6":function(e,t,n){e.exports=n.p+"img/Vivid_logo design2020-05.fc1a00c6.png"},"34fb":function(e,t,n){"use strict";var a=n("8bc6"),o=n.n(a);o.a},"37e1":function(e,t,n){},"3bd0":function(e,t,n){"use strict";var a=n("a303"),o=n.n(a);o.a},"466e":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("534e"),n("f89d");var a=n("2b0e"),o=n("b29a"),i=n.n(o),s=n("4b3d"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-ons-navigator",{attrs:{swipeable:"","page-stack":e.pageStack},on:{"push-page":function(t){return e.pageStack.push(t)},"back-page":function(t){return e.pageStack.pop()}}})},c=[],d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-ons-page",[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("v-ons-button",{staticStyle:{"background-color":"Transparent"}},[n("ons-icon",{staticStyle:{color:"#1d1d1b"},attrs:{size:"12px",icon:"fa-bars"}})],1)],1),n("div",{staticClass:"center"},[n("v-ons-segment",{staticStyle:{width:"8em"},attrs:{"tabbar-id":"homeTabbar",index:e.segmentIndex},on:{"update:index":function(t){e.segmentIndex=t}}},[n("button",[e._v("Wallet")]),n("button",[e._v("Request")])])],1),n("div",{staticClass:"right"},[n("v-ons-button",{staticStyle:{"background-color":"Transparent"},on:{click:e.pushToFilterStreamPage}},[n("ons-icon",{staticStyle:{color:"#1d1d1b"},attrs:{size:"12px",icon:"fa-filter"}})],1)],1)]),n("v-ons-tabbar",{attrs:{id:"homeTabbar",tabs:e.tabs,index:e.tabbarIndex},on:{"update:index":function(t){e.tabbarIndex=t},"push-page":e.pushToViewStreamPage,"back-page":e.popViewPage}})],1)},l=[],u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-ons-page",{attrs:{id:"requestStreamPage"}},[a("v-ons-list",[a("v-ons-list-item",{attrs:{id:"optionsPanel_section",expandable:"",expanded:e.optionsPanelView},on:{"update:expanded":function(t){e.optionsPanelView=t}}},[a("span",{attrs:{id:"optionsPanel_section_title"}},[e._v("request options")]),a("div",{staticClass:"expandable-content"},[a("div",{attrs:{id:"options_panel"}},[a("v-ons-row",[a("v-ons-col",[a("span",{staticClass:"optionsPanelRowTitle"},[e._v("Tags:")]),a("span",{staticClass:"badge badge-pill badge-primary optionsPanelRow"},[e._v("Street View")])])],1),a("v-ons-row",[a("v-ons-col",[a("span",{staticClass:"optionsPanelRowTitle"},[e._v("Will Accept:")]),a("span",{staticClass:"optionsPanelRow"},[e._v("Side view of santa parade")])])],1),a("v-ons-row",[a("v-ons-col",[a("span",{staticClass:"optionsPanelRowTitle"},[e._v("Tip Offered:")]),a("span",{staticClass:"optionsPanelRow"},[e._v("$0.05/min")])])],1),a("v-ons-row",[a("v-ons-col",[a("span",{staticClass:"optionsPanelRowTitle"},[e._v("Range:")]),a("v-ons-range",{attrs:{size:"0.813em"}})],1)],1)],1)])])],1),a("img",{attrs:{id:"vivid_logo",src:n("22a6")}}),a("div",{staticClass:"map",attrs:{id:"map"}}),a("section",{attrs:{id:"nav_buttons"}},[a("v-ons-list"),a("div",{attrs:{id:"pushToViewStreamPageButton"}},[a("v-ons-button",{on:{click:function(t){return e.pushToViewStreamPage()}}},[e._v("Send Video Request")])],1)],1)],1)},m=[],p=(n("99af"),n("d81d"),n("6cc5"),n("ef9d"),n("e11e")),f=(n("c293"),n("c6e0")),g=new f["EsriProvider"],h={name:"requestStream",data:function(){return{map:null,tileLayer:null,layers:[],options:{enableHighAccuracy:!0,timeout:5e3,maximumAge:0},myLocation:null,myLocationCircle:null,geoSearchLocation:null,geoSearchLocationCircle:null,defaultRadius:92,optionsPanelView:!0,streamerIcon:null,redMarker:null}},methods:{testit:function(){console.log("change the page")},pushToViewStreamPage:function(){this.$emit("push-page")},addIDEALondonMarker:function(){p["marker"]([51.520748,-.08504]).addTo(this.map).bindPopup("IEDALondon, London EC2A 2BB"),p["circle"]([51.520748,-.08504],this.defaultRadius).addTo(this.map),this.map.setView([51.520748,-.08504],15)},geoSearchEvent:function(e){this.myLocation&&this.map.removeLayer(this.myLocation),this.myLocationCircle&&this.map.removeLayer(this.myLocationCircle),this.geoSearchLocation&&this.map.removeLayer(this.geoSearchLocation),this.geoSearchLocationCircle&&this.map.removeLayer(this.geoSearchLocationCircle),this.geoSearchLocation=p["marker"]([e.location.y,e.location.x]).addTo(this.map).bindPopup(e.location.label).openPopup(),this.geoSearchLocationCircle=p["circle"]([e.location.y,e.location.x],this.defaultRadius).addTo(this.map),this.map.setView([e.location.y,e.location.x],15)},onLocationFound:function(e){var t=e.accuracy;this.myLocation=p["marker"](e.latlng).addTo(this.map).bindPopup("You are here").openPopup(),this.myLocationCircle=p["circle"](e.latlng,t).addTo(this.map)},onLocationError:function(e){this.$ons.notification.alert(e.message),this.map.setView([51.520748,-.08504],15)},initMap:function(){this.map=p["map"]("map").setView([51.520748,-.08504],15),this.addIDEALondonMarker(),new f["GeoSearchControl"]({provider:g,showMarker:!0,showPopup:!1,marker:{icon:new p["Icon"].Default,draggable:!1},maxMarkers:1,retainZoomLevel:!1,animateZoom:!0,autoClose:!0,searchLabel:"Enter address",keepResult:!1}).addTo(this.map),this.map.on("geosearch/showlocation",this.geoSearchEvent),document.getElementById("optionsPanel_section").showExpansion()},initLayers:function(){this.tileLayer=p["tileLayer"]("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWEwNnJpaSIsImEiOiJjazZkeTU2NnAxbWF4M2xxajN6NWIyb2l6In0.4iTjEpS8cIa_Um3zhE9keQ",{attribution:!1,maxZoom:36,id:"mapbox/streets-v11"}).addTo(this.map)},locationSuccess:function(e){var t=e.coords;console.log("Your current position is:"),console.log("Latitude : ".concat(t.latitude)),console.log("Longitude: ".concat(t.longitude)),console.log("More or less ".concat(t.accuracy," meters."))},locationError:function(e){console.warn("ERROR(".concat(e.code,"): ").concat(e.message))}},mounted:function(){this.initMap(),this.initLayers(),this.map.on("locationfound",this.onLocationFound),this.map.on("locationerror",this.onLocationError)}},b=h,v=(n("34fb"),n("2877")),w=Object(v["a"])(b,u,m,!1,null,"374824bc",null),y=w.exports,S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-ons-page",{attrs:{id:"walletPage"}},[n("v-ons-card",[n("div",{staticClass:"title"},[e._v("Balance")]),n("div",{staticClass:"content"},[n("strong",[e._v("$ 230.00")])])]),n("section",{staticStyle:{"text-align":"center"},attrs:{id:"wallet_transaction_buttons"}},[n("div",{staticStyle:{display:"block"}},[n("v-ons-button",{staticStyle:{"margin-top":"1em","margin-right":"2em",width:"5em","background-color":"indigo"}},[e._v("Send")]),n("v-ons-button",{staticStyle:{"margin-top":"1em","margin-left":"2em",width:"5em","background-color":"indigo"}},[e._v("Receive")])],1)])],1)},_=[],C={name:"wallet",data:function(){return{}},methods:{}},k=C,P=(n("eaea"),Object(v["a"])(k,S,_,!1,null,"6ab2f1ac",null)),x=P.exports,T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-ons-page",{attrs:{id:"requestStreamFiltersPage"}},[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("v-ons-back-button")],1),n("div",{staticClass:"center"},[n("span",{staticClass:"badge badge-default onsPageTitleStyle"},[e._v("Request Options")])])]),n("v-ons-list",[n("v-ons-list-item",{attrs:{id:"tags_panel",expandable:"",expanded:e.tagsPanelView},on:{"update:expanded":function(t){e.tagsPanelView=t},click:function(t){return e.togglePanel("tags_panel")}}},[n("span",{attrs:{id:"expandable_section_title"}},[e._v("tags")]),n("div",{staticClass:"expandable-content"},e._l(e.tagOptions,(function(t,a){return n("v-ons-list-item",{key:t,attrs:{tappable:""}},[n("label",{staticClass:"left"},[n("v-ons-checkbox",{attrs:{"input-id":"checkbox-"+a,value:t},model:{value:e.tagOptionsChecked,callback:function(t){e.tagOptionsChecked=t},expression:"tagOptionsChecked"}})],1),n("label",{staticClass:"center",attrs:{for:"checkbox-"+a}},[e._v(e._s(t))])])})),1)])],1),n("v-ons-list",[n("v-ons-list-item",{attrs:{id:"willAccept_panel",expandable:"",expanded:e.willAcceptPanelView},on:{"update:expanded":function(t){e.willAcceptPanelView=t},click:function(t){return e.togglePanel("willAccept_panel")}}},[n("span",{attrs:{id:"expandable_section_title"}},[e._v("will accept")]),n("div",{staticClass:"expandable-content"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.willAcceptPanelText,expression:"willAcceptPanelText"}],staticClass:"textarea textarea--transparent",attrs:{maxlength:"140",rows:"6",placeholder:"Input message"},domProps:{value:e.willAcceptPanelText},on:{input:function(t){t.target.composing||(e.willAcceptPanelText=t.target.value)}}})])])],1),n("v-ons-list",[n("v-ons-list-item",{attrs:{id:"tipOffered_panel",expandable:"",expanded:e.tipOfferedView},on:{"update:expanded":function(t){e.tipOfferedView=t},click:function(t){return e.togglePanel("tipOffered_panel")}}},[n("span",{attrs:{id:"expandable_section_title"}},[e._v("tip offered")]),n("div",{staticClass:"expandable-content"},[n("v-ons-input",{attrs:{type:"number",placeholder:"Amount per minute",float:""},model:{value:e.tipOfferedAmount,callback:function(t){e.tipOfferedAmount=t},expression:"tipOfferedAmount"}})],1)])],1),n("v-ons-list",[n("v-ons-list-item",{attrs:{id:"currencyView_panel",expandable:"",expanded:e.currencyView},on:{"update:expanded":function(t){e.currencyView=t},click:function(t){return e.togglePanel("currencyView_panel")}}},[n("span",{attrs:{id:"expandable_section_title"}},[e._v("currency")]),n("div",{staticClass:"expandable-content"},[n("v-ons-list",e._l(e.currencyTickers,(function(t,a){return n("v-ons-list-item",{key:t,attrs:{tappable:""}},[n("label",{staticClass:"left"},[n("v-ons-radio",{attrs:{"input-id":"radio-"+a,value:t},model:{value:e.currencyTickerSelected,callback:function(t){e.currencyTickerSelected=t},expression:" currencyTickerSelected"}})],1),n("label",{staticClass:"center",attrs:{for:"radio-"+a}},[e._v(e._s(t))])])})),1)],1)])],1)],1)},I=[],E={name:"requestStreamFilters",data:function(){return{tagsPanelView:!1,tagOptions:["Street View","Crowds","Buildings"],tagOptionsChecked:["Street View"],willAcceptPanelView:!1,willAcceptPanelText:"Side view of santa parade",acceptanceDescription:"",tipOfferedView:!1,tipOfferedAmount:.05,currencyView:!1,currencyTickers:["USD","GBP","NEAR"],currencyTickerSelected:"USD"}},methods:{togglePanel:function(e){switch(!0){case"tags_panel"==e:this.tipOfferedView&&document.getElementById("tipOffered_panel").hideExpansion(),this.tipOfferedView=!1,this.currencyView&&document.getElementById("currencyView_panel").hideExpansion(),this.currencyView=!1,this.willAcceptPanelView&&document.getElementById("willAccept_panel").hideExpansion(),this.willAcceptPanelView=!1;break;case"willAccept_panel"==e:this.tipOfferedView&&document.getElementById("tipOffered_panel").hideExpansion(),this.tipOfferedView=!1,this.currencyView&&document.getElementById("currencyView_panel").hideExpansion(),this.currencyView=!1,this.tagsPanelView&&document.getElementById("tags_panel").hideExpansion(),this.tagsPanelView=!1;break;case"tipOffered_panel"==e:this.willAcceptPanelView&&document.getElementById("willAccept_panel").hideExpansion(),this.willAcceptPanelView=!1,this.currencyView&&document.getElementById("currencyView_panel").hideExpansion(),this.currencyView=!1,this.tagsPanelView&&document.getElementById("tags_panel").hideExpansion(),this.tagsPanelView=!1;break;case"currencyView_panel"==e:this.willAcceptPanelView&&document.getElementById("willAccept_panel").hideExpansion(),this.willAcceptPanelView=!1,this.tipOfferedView&&document.getElementById("tipOffered_panel").hideExpansion(),this.tipOfferedView=!1,this.tagsPanelView&&document.getElementById("tags_panel").hideExpansion(),this.tagsPanelView=!1;break;default:console.log(arguments)}}}},V=E,A=(n("661b"),Object(v["a"])(V,T,I,!1,null,"5b041c8e",null)),O=A.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-ons-page",{attrs:{id:"viewStreamPage"}},[a("v-ons-toolbar",[a("div",{staticClass:"left"},[a("v-ons-back-button")],1),a("div",{staticClass:"center"},[a("span",{staticClass:"onsPageTitleStyle"},[e._v("View Stream")])])]),a("v-ons-list",[a("v-ons-list-item",{attrs:{id:"optionsPanel_section_viewStream"}},[a("div",{attrs:{id:"pay-info-section"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.isWebMonetization,expression:"isWebMonetization"}],staticClass:"badge badge-warning",attrs:{id:"payingLabel"}},[e._v(" Paying "),a("strong",[a("i",[e._v(e._s(e.PayToUserName))])])]),a("span",{staticClass:"badge badge-pill badge-info",attrs:{id:"payment-ticker"}},[e._v(e._s("$ "+e.formattedTotalAmount))])]),a("div",{staticClass:"expandable-content"},[a("div",{attrs:{id:"options_panel"}})])])],1),a("div",{attrs:{id:"view-video-panel"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.inBuiltRequest,expression:"inBuiltRequest"}],staticClass:"container"},[a("div",{staticClass:"jumbotron"},[a("video",{attrs:{id:"inBuiltVideoExample",src:n("678e"),autoplay:"",playsinline:""}})])]),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.inBuiltRequest,expression:"!inBuiltRequest"}],staticClass:"container"},[a("div",{staticClass:"jumbotron"},[a("div",{attrs:{id:"video_info"}},[e._v(" Stream will start playing automatically "),a("br"),e._v("when it is live ")]),a("video",{attrs:{id:"remoteVideo",autoplay:"",controls:""}}),a("input",{directives:[{name:"model",rawName:"v-model",value:e.streamId,expression:"streamId"}],staticClass:"form-control",attrs:{type:"text",id:"streamName",placeholder:"Type stream name"},domProps:{value:e.streamId},on:{input:function(t){t.target.composing||(e.streamId=t.target.value)}}})])])]),a("section",{attrs:{id:"view_stream_nav_buttons_section"}},[a("div",{attrs:{id:"view_stream_nav_buttons_panel"}},[a("v-ons-button",{attrs:{id:"endStreamButton"},on:{click:function(t){return e.endViewingStream()}}},[e._v(" End Stream ")])],1)])],1)},R=[];n("b0c0"),n("d093"),n("7db0"),n("4160"),n("caad"),n("c975"),n("a15b"),n("a434"),n("2532"),n("159b");function L(e){var t=this;for(var n in t.peerconnection_config=null,t.sdp_constraints=null,t.remotePeerConnection=new Array,t.remoteDescriptionSet=new Array,t.iceCandidateList=new Array,t.webSocketAdaptor=null,t.roomName=null,t.videoTrackSender=null,t.audioTrackSender=null,t.playStreamId=new Array,t.micGainNode=null,t.localStream=null,t.isPlayMode=!1,t.debug=!1,t.camera_location="top",t.camera_margin=15,t.camera_percent=15,e)Object.prototype.hasOwnProperty.call(e,n)&&(this[n]=e[n]);if(t.localVideo=document.getElementById(t.localVideoId),t.remoteVideo=document.getElementById(t.remoteVideoId),!("WebSocket"in window))return console.log("WebSocket not supported."),void t.callbackError("WebSocketNotSupported");if("undefined"==typeof navigator.mediaDevices&&0==t.isPlayMode)return console.log("Cannot open camera and mic because of unsecure context. Please Install SSL(https)"),void t.callbackError("UnsecureContext");if(this.getUserMedia=function(e,n){navigator.mediaDevices.getUserMedia(e).then((function(a){var o=a.getAudioTracks();if(o.length>0&&a.removeTrack(o[0]),"undefined"!=e.video&&"undefined"!=typeof e.video.mandatory&&"undefined"!=typeof e.video.mandatory.chromeMediaSource&&"desktop"==e.video.mandatory.chromeMediaSource&&(a.getVideoTracks()[0].onended=function(){t.callback("screen_share_stopped")}),"undefined"!=n&&0!=n){var i={audio:n};navigator.mediaDevices.getUserMedia(i).then((function(e){"undefined"!=t.mediaConstraints&&"screen+camera"==t.mediaConstraints.video?navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(n){var o=document.createElement("canvas"),i=o.getContext("2d"),s=document.createElement("video");s.srcObject=a,s.play();var r=document.createElement("video");r.srcObject=n,r.play();var c=o.captureStream(15);c.addTrack(e.getAudioTracks()[0]),t.gotStream(c),setInterval((function(){o.width=s.videoWidth,o.height=s.videoHeight,i.drawImage(s,0,0,o.width,o.height);var e,n=s.videoWidth*(t.camera_percent/100),a=r.videoHeight/r.videoWidth*n,c=o.width-n-t.camera_margin;e="top"==t.camera_location?t.camera_margin:o.height-a-t.camera_margin,i.drawImage(r,c,e,n,a)}),66)})).catch((function(e){t.callbackError(e.name,e.message)})):(a.addTrack(e.getAudioTracks()[0]),t.gotStream(a))})).catch((function(e){t.callbackError(e.name,e.message)}))}})).catch((function(e){t.callbackError(e.name,e.message)}))},this.openScreen=function(e){var n=function n(a){if("rtcmulticonnection-extension-loaded"==a.data)console.debug("rtcmulticonnection-extension-loaded parameter is received"),window.postMessage("get-sourceId","*");else if("PermissionDeniedError"==a.data)console.debug("Permission denied error"),t.callbackError("screen_share_permission_denied");else if(a.data&&a.data.sourceId){var o={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a.data.sourceId},optional:[]}};t.getUserMedia(o,e),window.removeEventListener("message",n)}};window.addEventListener("message",n,!1),window.postMessage("are-you-there","*")},this.openStream=function(e){t.mediaConstraints=e;var n=!1;"undefined"!=typeof e.audio&&0!=e.audio&&(n=e.audio),"undefined"!=typeof e.video?"screen+camera"==e.video||"screen"==e.video?this.openScreen(n):t.getUserMedia(e,n):(console.error("MediaConstraint video is not defined"),t.callbackError("media_constraint_video_not_defined"))},this.closeStream=function(){t.localStream.getVideoTracks().forEach((function(e){e.onended=null,e.stop()})),t.localStream.getAudioTracks().forEach((function(e){e.onended=null,e.stop()}))},this.checkExtension=function(){var e=function e(n){"rtcmulticonnection-extension-loaded"==n.data&&(t.callback("screen_share_extension_available"),window.removeEventListener("message",e))};window.addEventListener("message",e,!1),window.postMessage("are-you-there","*")},t.checkExtension(),this.isPlayMode||"undefined"==typeof t.mediaConstraints||null!=this.localStream)null!=t.webSocketAdaptor&&0!=t.webSocketAdaptor.isConnected()||(t.webSocketAdaptor=new o);else if("undefined"!=typeof t.mediaConstraints.video&&0!=t.mediaConstraints.video)t.mediaConstraints.audio.mandatory?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){navigator.mediaDevices.getUserMedia(t.mediaConstraints).then((function(n){var a=new AudioContext,o=a.createGain();o.gain.value=1;var i=a.createMediaStreamDestination(),s=a.createMediaStreamSource(n);s.connect(o),t.micGainNode=a.createGain(),t.micGainNode.gain.value=1;var r=a.createMediaStreamSource(e);r.connect(t.micGainNode),o.connect(i),t.micGainNode.connect(i),n.removeTrack(n.getAudioTracks()[0]),i.stream.getAudioTracks().forEach((function(e){n.addTrack(e)})),console.debug("Running gotStream"),t.gotStream(n)})).catch((function(e){t.callbackError(e.name,e.message)}))})).catch((function(e){t.callbackError(e.name,e.message)})):t.openStream(t.mediaConstraints,t.mode);else{var a={audio:t.mediaConstraints.audio};navigator.mediaDevices.getUserMedia(a).then((function(e){t.gotStream(e)})).catch((function(e){t.callbackError(e.name,e.message)}))}function o(){var e=new WebSocket(t.websocket_url),n=!1,a=-1,o=function(){-1!=a&&(t.debug&&console.debug("Clearing ping message timer"),clearInterval(a),a=-1)},i=function(){e.send;var t={command:"ping"};e.send(JSON.stringify(t))};this.close=function(){e.close()},e.onopen=function(){t.debug&&console.log("websocket connected"),a=setInterval((function(){i()}),5e3),n=!0,t.callback("initialized")},this.send=function(n){0!=e.readyState&&2!=e.readyState&&3!=e.readyState?(e.send(n),console.log("sent message:"+n)):t.callbackError("WebSocketNotConnected")},this.isConnected=function(){return n},e.onmessage=function(e){var n=JSON.parse(e.data);"start"==n.command?(t.debug&&console.debug("received start command"),t.startPublishing(n.streamId)):"takeCandidate"==n.command?(t.debug&&(console.debug("received ice candidate for stream id "+n.streamId),console.debug(n.candidate)),t.takeCandidate(n.streamId,n.label,n.candidate)):"takeConfiguration"==n.command?(t.debug&&console.log("received remote description type for stream id: "+n.streamId+" type: "+n.type),t.takeConfiguration(n.streamId,n.sdp,n.type)):"stop"==n.command?(console.debug("Stop command received"),t.closePeerConnection(n.streamId)):"error"==n.command?t.callbackError(n.definition):"notification"==n.command?(t.callback(n.definition,n),"play_finished"!=n.definition&&"publish_finished"!=n.definition||t.closePeerConnection(n.streamId)):"streamInformation"==n.command?t.callback(n.command,n):"pong"==n.command&&t.callback(n.command)},e.onerror=function(e){console.log(" error occured: "+JSON.stringify(e)),o(),t.callbackError(e)},e.onclose=function(e){n=!1,console.log("connection closed."),o(),t.callback("closed",e)}}this.enableMicInMixedAudio=function(e){null!=t.micGainNode&&(t.micGainNode.gain.value=e?1:0)},this.publish=function(e,n){var a={command:"publish",streamId:e,token:n,video:t.localStream.getVideoTracks().length>0,audio:t.localStream.getAudioTracks().length>0};t.webSocketAdaptor.send(JSON.stringify(a))},this.joinRoom=function(e,n){t.roomName=e;var a={command:"joinRoom",room:e,streamId:n};t.webSocketAdaptor.send(JSON.stringify(a))},this.play=function(e,n,a){t.playStreamId.push(e);var o={command:"play",streamId:e,token:n,room:a};t.webSocketAdaptor.send(JSON.stringify(o))},this.stop=function(e){t.closePeerConnection(e);var n={command:"stop",streamId:e};t.webSocketAdaptor.send(JSON.stringify(n))},this.join=function(e){var n={command:"join",streamId:e};t.webSocketAdaptor.send(JSON.stringify(n))},this.leaveFromRoom=function(e){t.roomName=e;var n={command:"leaveFromRoom",room:e};console.log("leave request is sent for "+e),t.webSocketAdaptor.send(JSON.stringify(n))},this.leave=function(e){var n={command:"leave",streamId:e};t.webSocketAdaptor.send(JSON.stringify(n)),t.closePeerConnection(e)},this.getStreamInfo=function(e){var t={command:"getStreamInfo",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))},this.gotStream=function(e){t.localStream=e,t.localVideo.srcObject=e,null!=t.webSocketAdaptor&&0!=t.webSocketAdaptor.isConnected()||(t.webSocketAdaptor=new o)},this.switchVideoCapture=function(e){var n={video:!0,audio:!1};t.switchVideoSource(e,n,null)},this.switchDesktopCapture=function(e){var n=function n(a){if("rtcmulticonnection-extension-loaded"==a.data)console.debug("rtcmulticonnection-extension-loaded parameter is received"),window.postMessage("get-sourceId","*");else if("PermissionDeniedError"==a.data)console.debug("Permission denied error"),t.callbackError("screen_share_permission_denied");else if(a.data&&a.data.sourceId){var o={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a.data.sourceId},optional:[]}};t.switchVideoSource(e,o,(function(){t.callback("screen_share_stopped"),t.switchVideoCapture(e)})),window.removeEventListener("message",n)}};window.addEventListener("message",n,!1),window.postMessage("are-you-there","*")},t.arrangeStreams=function(e,n){var a=t.localStream.getVideoTracks()[0];t.localStream.removeTrack(a),a.stop(),t.localStream.addTrack(e.getVideoTracks()[0]),t.localVideo.srcObject=t.localStream,null!=n&&(e.getVideoTracks()[0].onended=function(e){n(e)})},this.switchVideoSource=function(e,n,a){navigator.mediaDevices.getUserMedia(n).then((function(n){if(null!=t.remotePeerConnection[e]){var o=t.remotePeerConnection[e].getSenders().find((function(e){return"video"==e.track.kind}));o.replaceTrack(n.getVideoTracks()[0]).then((function(){t.arrangeStreams(n,a)})).catch((function(e){console.log(e.name)}))}else t.arrangeStreams(n,a)})).catch((function(e){t.callbackError(e.name)}))},this.onTrack=function(e,n){if(console.log("onTrack"),null!=t.remoteVideo)t.remoteVideo.srcObject!==e.streams[0]&&(t.remoteVideo.srcObject=e.streams[0],console.log("Received remote stream"));else{var a={track:e.streams[0],streamId:n};t.callback("newStreamAvailable",a)}},this.iceCandidateReceived=function(e,n){if(e.candidate){var a={command:"takeCandidate",streamId:n,label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate};t.debug&&(console.log("sending ice candiate for stream Id "+n),console.log(JSON.stringify(e.candidate))),t.webSocketAdaptor.send(JSON.stringify(a))}},this.initPeerConnection=function(e){if(null==t.remotePeerConnection[e]){var n=e;console.log("stream id in init peer connection: "+e+" close dstream id: "+n),t.remotePeerConnection[e]=new RTCPeerConnection(t.peerconnection_config),t.remoteDescriptionSet[e]=!1,t.iceCandidateList[e]=new Array,t.playStreamId.includes(e)||t.remotePeerConnection[e].addStream(t.localStream),t.remotePeerConnection[e].onicecandidate=function(e){t.iceCandidateReceived(e,n)},t.remotePeerConnection[e].ontrack=function(e){t.onTrack(e,n)}}},this.closePeerConnection=function(e){if(null!=t.remotePeerConnection[e]&&"closed"!=t.remotePeerConnection[e].signalingState){t.remotePeerConnection[e].close(),t.remotePeerConnection[e]=null,delete t.remotePeerConnection[e];var n=t.playStreamId.indexOf(e);-1!=n&&t.playStreamId.splice(n,1)}},this.signallingState=function(e){return null!=t.remotePeerConnection[e]?t.remotePeerConnection[e].signalingState:null},this.iceConnectionState=function(e){return null!=t.remotePeerConnection[e]?t.remotePeerConnection[e].iceConnectionState:null},this.gotDescription=function(e,n){t.remotePeerConnection[n].setLocalDescription(e).then((function(){console.debug("Set local description successfully for stream Id "+n);var a={command:"takeConfiguration",streamId:n,type:e.type,sdp:e.sdp};t.debug&&(console.debug("local sdp: "),console.debug(e.sdp)),t.webSocketAdaptor.send(JSON.stringify(a))})).catch((function(e){console.error("Cannot set local description. Error is: "+e)}))},this.turnOffLocalCamera=function(){if(null!=t.remotePeerConnection){var e=t.localStream.getVideoTracks()[0];e.enabled=!1}else this.callbackError("NoActiveConnection")},this.turnOnLocalCamera=function(){if(null!=t.remotePeerConnection){var e=t.localStream.getVideoTracks()[0];e.enabled=!0}else this.callbackError("NoActiveConnection")},this.muteLocalMic=function(){if(null!=t.remotePeerConnection){var e=t.localStream.getAudioTracks()[0];e.enabled=!1}else this.callbackError("NoActiveConnection")},this.unmuteLocalMic=function(){if(null!=t.remotePeerConnection){var e=t.localStream.getAudioTracks()[0];e.enabled=!0}else this.callbackError("NoActiveConnection")},this.takeConfiguration=function(e,n,a){var o=e,i=a,s=n;t.initPeerConnection(o),t.remotePeerConnection[o].setRemoteDescription(new RTCSessionDescription({sdp:s,type:i})).then((function(e){t.debug&&(console.debug("set remote description is succesfull with response: "+e+" for stream : "+o+" and type: "+i),console.debug(s)),t.remoteDescriptionSet[o]=!0;var n=t.iceCandidateList[o].length;console.debug("Ice candidate list size to be added: "+n);for(var a=0;a<n;a++)t.addIceCandidate(o,t.iceCandidateList[o][a]);t.iceCandidateList[o]=[],"offer"==i&&(console.log("try to create answer for stream id: "+o),t.remotePeerConnection[o].createAnswer(t.sdp_constraints).then((function(e){console.log("created answer for stream id: "+o),t.gotDescription(e,o)})).catch((function(e){console.error("create answer error :"+e)})))})).catch((function(e){t.debug&&console.error("set remote description is failed with error: "+e)}))},this.takeCandidate=function(e,n,a){var o=e,i=n,s=a,r=new RTCIceCandidate({sdpMLineIndex:i,candidate:s});t.initPeerConnection(o),1==t.remoteDescriptionSet[o]?t.addIceCandidate(o,r):(console.debug("Ice candidate is added to list because remote description is not set yet"),t.iceCandidateList[o].push(r))},this.addIceCandidate=function(e,n){t.remotePeerConnection[e].addIceCandidate(n).then((function(){t.debug&&console.log("Candidate is added for stream "+e)})).catch((function(t){console.error("ice candiate cannot be added for stream id: "+e+" error is: "+t),console.error(n)}))},this.startPublishing=function(e){var n=e;t.initPeerConnection(n),t.remotePeerConnection[n].createOffer(t.sdp_constraints).then((function(e){t.gotDescription(e,n)})).catch((function(e){console.error("create offer error for stream id: "+n+" error: "+e)}))},this.closeWebSocket=function(){for(var e in t.remotePeerConnection)t.remotePeerConnection[e].close();t.remotePeerConnection=new Array,t.webSocketAdaptor.close()}}var N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-ons-page",{attrs:{id:"supplyStreamPage"}},[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("v-ons-back-button",{on:{click:function(t){return t.preventDefault(),e.closeVideoStream(t)}}})],1),n("div",{staticClass:"center"},[e._v("Supply Stream")])]),n("div",{staticClass:"container"},[n("div",{staticClass:"jumbotron"},[n("p",[n("video",{attrs:{id:"localVideo",autoplay:"",muted:"",controls:"",playsinline:""},domProps:{muted:!0}})]),n("v-ons-input",{staticClass:"form-control",attrs:{type:"text",id:"streamName",placeholder:"Type stream name"},model:{value:e.streamNameBox,callback:function(t){e.streamNameBox=t},expression:"streamNameBox"}}),n("p",[n("v-ons-button",{staticClass:"btn btn-info",attrs:{disabled:e.start_publish_button.disabled,id:"start_publish_button"},on:{click:e.startPublishing}},[e._v("Start Publishing")]),n("v-ons-button",{staticClass:"btn btn-info",attrs:{disabled:e.stop_publish_button.disabled,id:"stop_publish_button"},on:{click:e.stopPublishing}},[e._v("Stop Publishing")])],1),n("span",{staticClass:"label label-success",attrs:{id:"broadcastingInfo"}},[e._v("Publishing")])],1)])],1)},B=[],j=n("1157"),D=n.n(j),W={name:"supplyStream",data:function(){return{start_publish_button:{disabled:!0},stop_publish_button:{disabled:!0},screen_share_checkbox:"",install_extension_link:"",streamNameBox:"stream1",streamId:"",name:"",pc_config:"",sdpConstraints:"",mediaConstraints:"",webRTCAdaptor:""}},methods:{closeVideoStream:function(){this.webRTCAdaptor.closeStream(),this.webRTCAdaptor.closePeerConnection(),document.querySelector("ons-navigator").popPage({refresh:!0})},startPublishing:function(){this.streamId=this.streamNameBox,this.webRTCAdaptor.publish(this.streamId)},stopPublishing:function(){this.webRTCAdaptor.stop(this.streamId)},enableDesktopCapture:function(e){1==e?this.webRTCAdaptor.switchDesktopCapture(this.streamId):this.webRTCAdaptor.switchVideoCapture(this.streamId)},startAnimation:function(){var e=this;D()("#broadcastingInfo").fadeIn(800,(function(){D()("#broadcastingInfo").fadeOut(800,(function(){var t=e.webRTCAdaptor.signallingState(e.streamId);if(null!=t&&"closed"!=t){var n=e.webRTCAdaptor.iceConnectionState(e.streamId);null!=n&&"failed"!=n&&"disconnected"!=n&&e.startAnimation()}}))}))}},mounted:function(){var e=this;this.pc_config=null,this.sdpConstraints={OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},this.mediaConstraints={video:!0,audio:!0},this.webRTCAdaptor=new L({websocket_url:"wss://test.antmedia.io:5443/WebRTCAppEE/websocket",mediaConstraints:this.mediaConstraints,peerconnection_config:this.pc_config,sdp_constraints:this.sdpConstraints,localVideoId:"localVideo",debug:!0,callback:function(t,n){"initialized"==t?(console.log("initialized"),e.start_publish_button.disabled=!1,e.stop_publish_button.disabled=!0):"publish_started"==t?(console.log("publish started"),e.start_publish_button.disabled=!0,e.stop_publish_button.disabled=!1,e.startAnimation()):"publish_finished"==t?(console.log("publish finished"),e.start_publish_button.disabled=!1,e.stop_publish_button.disabled=!0):"screen_share_extension_available"==t||("screen_share_stopped"==t?console.log("screen share stopped"):"closed"==t&&"undefined"!=typeof n&&console.log("Connecton closed: "+JSON.stringify(n)))},callbackError:function(e,t){console.log("error callback: "+JSON.stringify(e));var n=JSON.stringify(e);"undefined"!=typeof t&&(n=t),-1!=e.indexOf("NotFoundError")?n="Camera or Mic are not found or not allowed in your device.":-1!=e.indexOf("NotReadableError")||-1!=e.indexOf("TrackStartError")?n="Camera or Mic is being used by some other process that does not not allow these devices to be read.":-1!=e.indexOf("OverconstrainedError")||-1!=e.indexOf("ConstraintNotSatisfiedError")?n="There is no device found that fits your video and audio constraints. You may change video and audio constraints.":-1!=e.indexOf("NotAllowedError")||-1!=e.indexOf("PermissionDeniedError")?n="You are not allowed to access camera and mic.":-1!=e.indexOf("TypeError")?n="Video/Audio is required.":-1!=e.indexOf("UnsecureContext")?n="Fatal Error: Browser cannot access camera and mic because of unsecure context. Please install SSL and access via https":-1!=e.indexOf("WebSocketNotSupported")&&(n="Fatal Error: WebSocket not supported in this browser"),alert(n)}})}},J=W,$=(n("c519"),Object(v["a"])(J,N,B,!1,null,null,null)),z=$.exports,U=n("901e"),q=n.n(U),F={name:"viewStream",data:function(){return{webRTCAdaptor:null,streamId1:"streamId",streamId:"stream2",pc_config:null,sdpConstraints:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},mediaConstraints:{video:!1,audio:!1},streamNameBox:"stream1",inBuiltRequest:!0,viewControlPanelView:!1,PayToUserName:"@ma06rii1",streamingPaused:!1,metaTag:null}},computed:{isWebMonetization:function(){return!(!this.$vueWebMonetizationStart||"started"!==this.$vueWebMonetizationStart.state)},formattedTotalAmount:function(){return new q.a(this.$vueWebMonetizationProgress.totalAmount,10).toFormat()}},methods:{pauseViewingStream:function(){document.getElementById("inBuiltVideoExample").pause(),this.streamingPaused=!0,this.removeWebMonetisationMetaTag()},playViewingStream:function(){document.getElementById("inBuiltVideoExample").play(),this.streamingPaused=!1,this.addWebMonetisationMetaTag()},startPayingAnimation:function(){var e=this;D()("#payingLabel").fadeIn(800,(function(){D()("#payingLabel").fadeOut(800,(function(){var t=e.$vueWebMonetizationStart;if(null!=t&&0!=t){var n=e.$vueWebMonetizationStart.state;null!=n&&"pending"!=n&&e.startPayingAnimation()}}))}))},report:function(){},pushToSupplyStreamPage:function(){this.$emit("push-page",z)},playVideo:function(){document.getElementById("remoteVideo").style.display="block",document.getElementById("remoteVideo").play().then((function(){document.getElementById("play_button").style.display="none"})).catch((function(){document.getElementById("play_button").style.display="block",console.log("User interaction needed to start playing")}))},startPlaying:function(){this.webRTCAdaptor.play(this.streamId)},stopPlaying:function(){this.webRTCAdaptor.stop()},removeWebMonetisationMetaTag:function(){document.querySelector('meta[name="monetization"]').remove()},addWebMonetisationMetaTag:function(){this.metaTag=document.createElement("meta"),this.metaTag.name="monetization",this.metaTag.content="$twitter.xrptipbot.com/ma06rii1",document.head.appendChild(this.metaTag)},endViewingStream:function(){this.removeWebMonetisationMetaTag(),this.$emit("back-page")}},mounted:function(){var e=this;this.playViewingStream(),D()(document).on("postpop","#navigator",(function(){console.log("postpop")})),this.webRTCAdaptor=new L({websocket_url:"wss://test.antmedia.io:5443/WebRTCAppEE/websocket",mediaConstraints:this.mediaConstraints,peerconnection_config:this.pc_config,sdp_constraints:this.sdpConstraints,remoteVideoId:"remoteVideo",isPlayMode:!0,debug:!0,callback:function(t,n){"initialized"==t?(console.log("initialized"),e.webRTCAdaptor.getStreamInfo(e.streamId)):"streamInformation"==t?(console.log("stream information"),e.webRTCAdaptor.play(e.streamId)):"play_started"==t?(console.log("play started"),document.getElementById("video_info").style.display="none",e.playVideo()):"play_finished"==t?(console.log("play finished"),setTimeout((function(){this.webRTCAdaptor.getStreamInfo(this.streamId)}),3e3)):"closed"==t&&"undefined"!=typeof n&&console.log("Connecton closed: "+JSON.stringify(n))},callbackError:function(e){console.log("error callback: "+JSON.stringify(e)),"no_stream_exist"==e&&setTimeout((function(){}),3e3)}})},created:function(){this.addWebMonetisationMetaTag()},beforeDestroy:function(){this.removeWebMonetisationMetaTag()}},G=F,Y=(n("3bd0"),Object(v["a"])(G,M,R,!1,null,null,null)),Z=Y.exports,H={name:"home",data:function(){return{tabs:[{page:x,key:"Wallet"},{page:y,key:"RequestStream"}],tabbarIndex:1,segmentIndex:1}},methods:{log:function(){var e;(e=console).log.apply(e,arguments)},pushToFilterStreamPage:function(){this.$emit("push-page",{extends:O,onsNavigatorOptions:{animation:"lift",animationOptions:{duration:.5}}})},pushToViewStreamPage:function(){this.$emit("push-page",Z)},popViewPage:function(){this.$emit("back-page")}}},Q=H,K=(n("d78a"),Object(v["a"])(Q,d,l,!1,null,"5d4844ae",null)),X=K.exports,ee={name:"main_page",data:function(){return{pageStack:[X]}}},te=ee,ne=(n("034f"),Object(v["a"])(te,r,c,!1,null,null,null)),ae=ne.exports;a["a"].use(i.a),a["a"].use(s["a"]),a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(ae)}}).$mount("#app")},"661b":function(e,t,n){"use strict";var a=n("466e"),o=n.n(a);o.a},"678e":function(e,t,n){e.exports=n.p+"media/santa5.f6f22098.mp4"},"67a2":function(e,t,n){},"85ec":function(e,t,n){},"8bc6":function(e,t,n){},"96aa":function(e,t,n){},a303:function(e,t,n){},c519:function(e,t,n){"use strict";var a=n("67a2"),o=n.n(a);o.a},d78a:function(e,t,n){"use strict";var a=n("37e1"),o=n.n(a);o.a},eaea:function(e,t,n){"use strict";var a=n("96aa"),o=n.n(a);o.a}});
//# sourceMappingURL=app.b38973f9.js.map